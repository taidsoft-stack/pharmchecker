<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>êµ¬ë… í”Œëœ ì„ íƒ - PharmChecker</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 40px 20px;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    .header {
      text-align: center;
      color: white;
      margin-bottom: 50px;
    }
    .header h1 {
      font-size: 36px;
      margin-bottom: 10px;
    }
    .header p {
      font-size: 18px;
      opacity: 0.9;
    }
    .plans-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 30px;
      margin-bottom: 40px;
    }
    .plan-card {
      background: white;
      border-radius: 20px;
      padding: 40px 30px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      transition: transform 0.3s, box-shadow 0.3s;
      cursor: pointer;
      position: relative;
    }
    .plan-card:hover {
      transform: translateY(-10px);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
    }
    .plan-card.recommended {
      border: 3px solid #667eea;
    }
    .plan-card.recommended::before {
      content: 'ì¶”ì²œ';
      position: absolute;
      top: -15px;
      right: 20px;
      background: #667eea;
      color: white;
      padding: 5px 20px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 600;
    }
    .plan-name {
      font-size: 28px;
      font-weight: 700;
      color: #2c3e50;
      margin-bottom: 10px;
    }
    .plan-price {
      font-size: 42px;
      font-weight: 800;
      color: #667eea;
      margin-bottom: 5px;
    }
    .plan-price span {
      font-size: 18px;
      color: #7f8c8d;
      font-weight: 400;
    }
    .plan-limit {
      font-size: 16px;
      color: #7f8c8d;
      margin-bottom: 30px;
    }
    .plan-features {
      list-style: none;
      margin-bottom: 30px;
    }
    .plan-features li {
      padding: 10px 0;
      color: #34495e;
      border-bottom: 1px solid #ecf0f1;
    }
    .plan-features li:before {
      content: 'âœ“';
      color: #27ae60;
      font-weight: bold;
      margin-right: 10px;
    }
    .select-btn {
      width: 100%;
      padding: 15px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }
    .select-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }
    .notice {
      background: white;
      border-radius: 15px;
      padding: 25px;
      margin-top: 30px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }
    .notice h3 {
      color: #2c3e50;
      margin-bottom: 15px;
      font-size: 18px;
    }
    .notice ul {
      list-style: none;
      color: #7f8c8d;
      line-height: 1.8;
    }
    .notice li:before {
      content: 'â€¢';
      color: #667eea;
      font-weight: bold;
      margin-right: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ’Š PharmChecker</h1>
      <p>ì•½êµ­ì— ë”± ë§ëŠ” í”Œëœì„ ì„ íƒí•˜ì„¸ìš”</p>
    </div>

    <div class="plans-grid" id="plansGrid">
      <!-- í”Œëœ ì¹´ë“œëŠ” ì„œë²„ì—ì„œ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
    </div>

    <div class="notice">
      <h3>ğŸ“Œ ì•ˆë‚´ì‚¬í•­</h3>
      <ul>
        <li>ì²« ë‹¬ì€ ì„ íƒí•˜ì‹  í”Œëœìœ¼ë¡œ ê³ ì •ë˜ë©°, ì‚¬ìš©ëŸ‰ ì´ˆê³¼ ì‹œì—ë„ ì¶”ê°€ ìš”ê¸ˆì´ ë°œìƒí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</li>
        <li>ë‘ ë²ˆì§¸ ë‹¬ë¶€í„°ëŠ” ì‹¤ì œ ì‚¬ìš©ëŸ‰ì„ ê¸°ì¤€ìœ¼ë¡œ ìë™ìœ¼ë¡œ í”Œëœì´ ê²°ì •ë©ë‹ˆë‹¤.</li>
        <li>ê²°ì œëŠ” ë§¤ì›” ìë™ìœ¼ë¡œ ì´ë£¨ì–´ì§€ë©°, ì–¸ì œë“ ì§€ í•´ì§€ ê°€ëŠ¥í•©ë‹ˆë‹¤.</li>
        <li>í† ìŠ¤í˜ì´ë¨¼ì¸  ìë™ê²°ì œë¡œ ì•ˆì „í•˜ê²Œ ê´€ë¦¬ë©ë‹ˆë‹¤.</li>
      </ul>
    </div>
  </div>

  <script>
    // ì‚¬ìš©ì ì •ë³´ í™•ì¸
    const user = JSON.parse(sessionStorage.getItem('user') || '{}');
    if (!user.userId) {
      alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
      window.location.href = '/login';
    }

    // í”Œëœ ë°ì´í„° ë¡œë“œ
    async function loadPlans() {
      try {
        const response = await fetch('/api/subscription/plans');
        const result = await response.json();

        if (result.success && result.data) {
          renderPlans(result.data);
        } else {
          alert('í”Œëœ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
      } catch (error) {
        console.error('í”Œëœ ë¡œë“œ ì—ëŸ¬:', error);
        alert('í”Œëœ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
      }
    }

    // í”Œëœ ì¹´ë“œ ë Œë”ë§
    function renderPlans(plans) {
      const plansGrid = document.getElementById('plansGrid');
      plansGrid.innerHTML = '';

      plans.forEach((plan, index) => {
        const card = document.createElement('div');
        card.className = 'plan-card' + (index === 1 ? ' recommended' : '');
        
        const features = [
          'ì‹¤ì‹œê°„ ë³µì•½ ìˆœì‘ë„ ëª¨ë‹ˆí„°ë§',
          'ìŠ¤ë§ˆíŠ¸ ì•Œë¦¼ ì‹œìŠ¤í…œ',
          'í™˜ìë³„ ë§ì¶¤ ê´€ë¦¬',
          'ë°ì´í„° ê¸°ë°˜ ì¸ì‚¬ì´íŠ¸',
          '24/7 ê³ ê° ì§€ì›'
        ];

        card.innerHTML = `
          <div class="plan-name">${plan.plan_name}</div>
          <div class="plan-price">
            ${plan.monthly_price.toLocaleString()}<span>ì›/ì›”</span>
          </div>
          <div class="plan-limit">
            ì¼ë³„ ìµœëŒ€ ${plan.daily_rx_limit === null || plan.daily_rx_limit >= 999999 ? 'ë¬´ì œí•œ' : plan.daily_rx_limit + 'ê±´'}
          </div>
          <ul class="plan-features">
            ${features.map(f => `<li>${f}</li>`).join('')}
          </ul>
          <button class="select-btn" onclick="selectPlan('${plan.plan_id}', '${plan.plan_name}', ${plan.monthly_price})">
            ì„ íƒí•˜ê¸°
          </button>
        `;
        
        plansGrid.appendChild(card);
      });
    }

    // í”Œëœ ì„ íƒ
    async function selectPlan(planId, planName, price) {
      if (!confirm(`${planName} í”Œëœ (${price.toLocaleString()}ì›/ì›”)ì„ ì„ íƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
        return;
      }

      try {
        // ê²°ì œ í˜ì´ì§€ë¡œ ì´ë™í•˜ë©´ì„œ í”Œëœ ì •ë³´ ì „ë‹¬
        sessionStorage.setItem('selectedPlan', JSON.stringify({
          planId: planId,
          planName: planName,
          price: price
        }));
        
        window.location.href = '/subscription/payment';
      } catch (error) {
        console.error('í”Œëœ ì„ íƒ ì—ëŸ¬:', error);
        alert('í”Œëœ ì„ íƒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ í”Œëœ ë¶ˆëŸ¬ì˜¤ê¸°
    loadPlans();
  </script>
</body>
</html>
